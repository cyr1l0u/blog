---
title: "Custom-written DNS servers: Learn to love them"
date: "2010-08-11T07:15:00.001+02:00"
tags: [ DNS ]
---

<p>A cryptic e-mail message from one of my readers telling me that <em>blog.ioshints.info </em>does not resolve into an IP address (yet again, thank you Igor!) set just the right mood for my Monday morning. As I had about 30 minutes before rushing off to a day-long countryside family event, all I could do was run a few quick tests (of course it worked for me) and take my iPad with me (luckily, it’s a 3G model and the coverage in Slovenia is decent).</p>
<p>During the day, Igor was able to supply more details: the DNS hosting company I was using suddenly decided to return NXDOMAIN error code on every CNAME record unless the query type was CNAME, while providing the results in the response at the same time. Here’s a sample of their bizarre reasoning:</p>
<pre class="code">$ <strong>dig @ns1.domaindiscover.com xml.ioshints.info</strong><br />;; Got answer:<br />;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: <span style="color: #FF0000;"><strong>NXDOMAIN</strong></span>, id: 14206<br />;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 0<br />;; WARNING: recursion requested but not available<br /><br />;; QUESTION SECTION:<br />;xml.ioshints.info.             IN      A<br /><br />;; ANSWER SECTION:<br />xml.ioshints.info.      0       IN      CNAME   ghs.google.com.</pre><!--more--><p>Correct answer is obviously somewhere along the lines of the following printout (I will not waste my time reading the RFCs to figure out all the potential correct answers ;). The authoritative name server supplies just the CNAME, not the final answer (it has no authority to do it) and obviously has to return the success code (as it found the name we were looking for).</p>
<pre class="code">$ <strong>dig @ns.nil.si blog.ioshints.info</strong><br />;; Got answer:<br />;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59148<br />;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 13, ADDITIONAL: 12<br />;; WARNING: recursion requested but not available<br /><br />;; QUESTION SECTION:<br />;blog.ioshints.info.            IN      A<br /><br />;; ANSWER SECTION:<br />blog.ioshints.info.     0       IN      CNAME   ghs.google.com.</pre><h4>Be liberal in what you accept</h4><p>The worst part of the puzzle was that I was able to reach the blog throughout the day (ensuring the DNS TTL of the CNAME record in the server I was using did expire) even using different Service Providers (and DNS servers). In the afternoon, as I was finally able to get hold of a reasonable PC (for whatever reason, I don’t think iPad is the proper platform to write longer texts) I tried to figure out the difference between Igor and myself and polled my Twitter friends. </p>
<p>Only a few of them had problems (weird) and Ethan was kind enough to help me with my troubleshooting efforts. It looks like most recursive DNS servers (including Google’s 8.8.8.8 and OpenDNS) don’t bark at NXDOMAIN error if the answer is included in the reply and happily continue the resolution process, while a few servers decide NXDOMAIN means what it should mean and return an error to the client.</p>
<h4>Let’s fake authority</h4><p>Digging further, Igor uncovered another stupidity: the programmers working for DomainDiscover decided to make their life extremely easy and generate fake SOA records. This is what they claim the authority for <em>google.com </em>is:</p>
<pre class="code">$ <strong>dig @ns1.domaindiscover.com xml.ioshints.info</strong><br /><br />... deleted ...<br /><br />;; AUTHORITY SECTION:<br />google.com.         3600    IN      SOA     ns1.tierra.net.<br />                    hostmaster.tierra.net. 2010080701 7200 1800 604800 28800</pre><p>One must wonder what these guys will do when DNSSEC comes knocking on their doors. I decided I don’t want to be there when that happens and moved my DNS server today.</p>
<h4>Conclusions</h4><p>I am sad to be forced to leave DomainDiscover. They were working perfectly for the last 5+ years I was using them, but obviously the load they were handling (and the pricing wars in the domain registration business) pushed them to cut a few corners too many.</p>
<p>Unfortunately, we can only expect to see more failures like this one as the industry goes through endless cycles of <em>doing more with less</em>.</p>

