---
title: "OMG, VXLAN Encapsulation Has No Security!"
date: "2015-04-24T11:32:00.000+02:00"
tags: [ VXLAN,security ]
---

<p>Every now and then someone actually looks at the VXLAN packet format and eventually figures out that VXLAN encapsulation doesn’t provide any intrinsic security.</p>
<p><strong>TL&amp;DR Summary</strong>: That’s old news, the sky is not falling, and deploying VXLAN won’t make your network less secure than traditional VLAN- or MPLS-based networks.<!--more--></p>
<p>Let’s start with the <em>old news </em>bit. This is a slide straight out of my <a href="https://my.ipspace.net/bin/list?id=NSXArch">VMware NSX Architecture</a> webinar (you can also <a href="https://my.ipspace.net/bin/get/NSXArch/2.3 - Overlay Virtual Networks Data Plane.mp4">watch the related video</a>).</p>
<div class="separator"><img border="0" data-original-height="768" data-original-width="1024" src="/2015/04/s550-VXLAN+Security.jpg"/></div>
<p>As I clearly pointed out at that time, you (RFC 2119) MUST make the VXLAN transport network absolutely secure – anyone gaining access to the VXLAN transport network can insert packets into any VXLAN segment and potentially glean packets traversing a VXLAN segment. The intruder can do even more havoc in multicast-based VXLAN implementations that rely on traditional Ethernet flooding-and-learning: packets sent from intruder’s IP address can overwrite MAC-to-VTEP mapping entries in VXLAN endpoints, allowing the intruder to attract traffic sent to a particular MAC address.</p>
<p>Not surprisingly (as VXLAN is based on VLAN forwarding model), it’s easy to do the same in any VLAN-based network. As soon as an intruder gains access to a trunked switch port or a core link, it’s game over. VXLAN is thus no less secure than traditional VLAN-based networks.</p>
<p>MPLS networks are not much better. Once you have access to an MPLS-based backbone, you can insert packets into any LSP. This was evident to anyone who wanted to spend a few minutes thinking about MPLS security in the last decades. For more details, see this <a href="https://www.blackhat.com/presentations/bh-europe-06/bh-eu-06-Rey-up.pdf">excellent presentation by Enno Rey</a>. </p>
<p class="note">Diverting MPLS traffic would require more effort, particularly in layer-3 MPLS-based VPNs.</p>
<p>Is it possible to insert VXLAN packets (and thus send traffic to other segments) from an end host? Sure – all you need is someone crazy enough to connect a server (or a VM) to the VLAN used for VXLAN transport, probably through some misguided use of native VLANs. Unfortunately there’s no easy cure for stupidity or fat fingers (in unrelated news, it’s also possible to read physical disk of an ESXi server if someone is <a href="http://www.insinuator.net/2012/05/vmdk-has-left-the-building/">stupid enough to allow customers to craft their own VMX files</a>).</p>
<p>VXLAN implementations using control-plane distribution of MAC-to-VTEP mappings (VMware NSX, Nuage VSP, Juniper Contrail, Cisco EVPN on Nexus 9K) are less vulnerable to traffic redirection attacks (unless, of course, they use a combination of control plane and dynamic MAC learning). They <em>might </em>also include anti-spoofing features, which would drop traffic sent from illegal source IP addresses (VTEPs), but that just shifts the problem to the core network, which has to validate source IP addresses based on input ports – how many times have you seen that done in a data center environment?</p>
<p>The best way to deal with this problem seems to be to reuse the best practices we used to build secure VLAN-based backbones: make sure it’s hard for an intruder to get access to the transport network. What I’m usually recommending in my <a href="http://www.ipspace.net/ExpertExpress">consulting engagements</a> is to build a separate leaf-and-spine fabric used solely for VXLAN transport, and never connect it directly to the data center core. This slide from the <a href="http://content.ipspace.net/get/NSXArch">VMware NSX Architecture</a> webinar illustrates a typical approach:</p>
<div class="separator"><a href="/2015/04/s1600-Cloud-as-Appliance.jpg" imageanchor="1"><img border="0" data-original-height="768" data-original-width="1024" src="/2015/04/s550-Cloud-as-Appliance.jpg"/></a></div>
<h4>Need more information?</h4><p>Start with the free <a href="http://content.ipspace.net/get/NSXArch">VMware NSX Architecture</a> webinar, continue with <a href="http://www.ipspace.net/Overlay_Virtual_Networking">Overlay Virtual Networking</a> and <a href="http://www.ipspace.net/VXLAN_Technical_Deep_Dive">VXLAN Technical Deep Dive</a> webinars, and conclude with <a href="http://www.ipspace.net/Designing_Private_Cloud_Infrastructure">Designing Private Cloud Infrastructure</a> one.</p>

