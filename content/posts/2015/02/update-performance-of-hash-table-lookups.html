---
title: "Update: Performance of Hash Table Lookups"
date: "2015-02-18T07:49:00.000+01:00"
tags: [ switching,Scalability,virtualization ]
---

<p>In the <a href="http://blog.ipspace.net/2015/02/myths-that-refuse-to-die-scalability-of.html">Myths That Refuse to Die: Scalability of Overlay Virtual Networking</a> blog post I wrote &ldquo;<em>number of MAC addresses has absolutely no impact on the forwarding performance until the MAC hash table overflows</em>&rdquo;, which happens to be <em>almost </em>true.<!--more--></p>
<p>As always, the devil is in the details: assuming you dedicate a CPU core (or more of them) to the forwarding process like Intel DPDK or <a href="http://blog.ipspace.net/2014/09/snabb-switch-deep-dive-on-software-gone.html">Snabb Switch</a> are doing, a small MAC table might fit into the CPU cache, while a hash lookup done on large MAC table inevitably results in accesses to main memory, which are way slower than reads from CPU cache.</p>
<p>I don&#x2019;t have any vSwitch results that would corroborate this line of thinking, but engineers doing properly designed tests of hash arrays in scripting languages came to the same conclusion &ndash; see <a href="https://scalability.org/?p=7274">Real Measurement Is Hard</a> for details (and enjoy the beauty of the Perl code, which proves that Perl doesn&#x2019;t have to look like line noise).</p>
<p class="note">If you understood the <em>line noise </em>reference above, you&#x2019;re way too old. Welcome to the &ldquo;grumpy old engineers&rdquo; club ;)</p>
<p>On a slightly tangential note, OVS developers try really hard to implement fast hash table lookups in recent OVS releases &ndash; if you like reading <a href="http://www.amazon.com/gp/product/0321751043/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0321751043&linkCode=as2&tag=cisioshinandt-20&linkId=3ZYIO5I22LH4FSQJ">Donald Knuth books</a>, you&#x2019;ll thoroughly enjoy <a href="https://github.com/openvswitch/ovs/blob/master/lib/cmap.c">Optimistic Concurrent Cuckoo Hash</a> (HT: <a href="http://highscalability.com/">highscalability.com</a> &ndash; an absolute must-read if you&#x2019;re interested in any aspect of scalability).</p>

