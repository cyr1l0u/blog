---
title: "Change in OSPF Designated Router creates extra network LSAs"
date: "2012-12-10T08:04:00.000+01:00"
tags: [ OSPF ]
---

<p>When testing the OSPF graceful shutdown feature, I've encountered an interesting OSPF feature: if you force a change in LAN DR router (other than rebooting the current DR), you'll end up with two network LSAs describing the same LAN.</p>
<p class="info">This blog has been sitting in my Draft folder for years, so Cisco IOS  behavior might have changed in the meantime, or it might have been a transient and/or race condition. Nonetheless, I still find it interesting.<!--more--></p>
<p>For example, if you force the B2 router in the following network to relinquish its DR status (by setting <strong>ip ospf priority 0</strong> on the interface), B1 will take over and generate another network LSA (as expected), but the network LSA generated by B2 will stay in the database for a while and both routers will claim they are connected to both network LSAs.</p>
<div class="separator" style="clear: both; text-align: center;"><a href="/2012/12/s1600-OSPF_Diagram.jpg" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="182" src="/2012/12/s400-OSPF_Diagram.jpg" width="400"/></a></div>
<p>Here are the corresponding show printouts. First the network LSAs before the change:</p>
<pre class="code">b2#show ip ospf 1 database | begin Net Link<br/>Net Link States (Area 0)<br/><br/>Link ID ADV Router Age Seq# Checksum<br/>10.0.0.6 172.16.0.12 283 0x80000001 0x007E52<br/>192.168.0.6 172.16.0.22 280 0x80000001 0x00044F</pre><p>... and the network LSA generated by B2 ...</p>
<pre class="code">b2#show ip ospf 1 database network 192.168.0.6<br/><br/>OSPF Router with ID (172.16.0.22) (Process ID 1)<br/><br/>Net Link States (Area 0)<br/><br/>Routing Bit Set on this LSA<br/>LS age: 284<br/>Options: (No TOS-capability, DC)<br/>LS Type: Network Links<br/>Link State ID: 192.168.0.6 (address of Designated Router)<br/>Advertising Router: 172.16.0.22<br/>LS Seq Number: 80000001<br/>Checksum: 0x44F<br/>Length: 32<br/>Network Mask: 255.255.255.0<br/>Attached Router: 172.16.0.22<br/>Attached Router: 172.16.0.21</pre><p>After the change, there is an extra network LSA in the database issued by B1<p><pre class="code">b2#show ip ospf 1 database | begin Net Link<br/>Net Link States (Area 0)<br/><br/>Link ID ADV Router Age Seq# Checksum<br/>10.0.0.6 172.16.0.12 324 0x80000001 0x007E52<br/>192.168.0.5 172.16.0.21 7 0x80000001 0x00183D<br/>192.168.0.6 172.16.0.22 321 0x80000001 0x00044F</pre><p>And, interestingly, both B1 and B2 claim they are connected to both network LSAs:</p>
<pre class="code">b2#show ip ospf 1 database router 172.16.0.21<br/><br/>OSPF Router with ID (172.16.0.22) (Process ID 1)<br/><br/>Router Link States (Area 0)<br/><br/>LS age: 43<br/>Options: (No TOS-capability, DC)<br/>LS Type: Router Links<br/>Link State ID: 172.16.0.21<br/>Advertising Router: 172.16.0.21<br/>LS Seq Number: 80000006<br/>Checksum: 0x1602<br/>Length: 84<br/>Number of Links: 5<br/><br/>Link connected to: a Stub Network<br/>(Link ID) Network/subnet number: 172.16.0.21<br/>(Link Data) Network Mask: 255.255.255.255<br/>Number of TOS metrics: 0<br/>TOS 0 Metrics: 1<br/><br/>Link connected to: another Router (point-to-point)<br/>(Link ID) Neighboring Router ID: 172.16.0.11<br/>(Link Data) Router Interface address: 172.16.1.2<br/>Number of TOS metrics: 0<br/>TOS 0 Metrics: 50<br/><br/>Link connected to: a Stub Network<br/>(Link ID) Network/subnet number: 172.16.1.0<br/>(Link Data) Network Mask: 255.255.255.252<br/>Number of TOS metrics: 0<br/>TOS 0 Metrics: 50<br/><br/><span class="high"> Link connected to: a Transit Network<br/>(Link ID) Designated Router address: 192.168.0.6<br/>(Link Data) Router Interface address: 192.168.0.5<br/>Number of TOS metrics: 0<br/>TOS 0 Metrics: 1<br/><br/>Link connected to: a Transit Network<br/>(Link ID) Designated Router address: 192.168.0.5<br/>(Link Data) Router Interface address: 192.168.0.5<br/>Number of TOS metrics: 0<br/>TOS 0 Metrics: 1</span></pre></p>
</p>

