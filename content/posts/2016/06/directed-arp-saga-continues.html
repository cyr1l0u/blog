---
title: "Directed ARP Saga Continues"
date: "2016-06-22T08:28:00.000+02:00"
tags: [ ARP ]
---

<p>Reading my <a href="http://blog.ipspace.net/2016/06/directed-arp-and-icmp-redirects.html">Directed ARP and ICMP Redirects</a> blog post you might have wondered &ldquo;<em>how did Directed ARP ever get into ***redacted***</em>?&rdquo;</p>
<p>I searched for &ldquo;directed ARP cisco&rdquo; and found <a href="https://supportforums.cisco.com/discussion/9703841/directed-arp-cisco-router">this gem</a>, which really talks about <em>unicast ARP </em>behavior, an ancient mechanism <a href="#page-22">documented in RFC 1122</a> (it&#x2019;s not my Google-Fu, I got the reference to RFC 1122 in <a href="http://www.embeddedsystemtesting.com/2012/08/can-arp-request-be-unicast.html">this blog post</a>).<!--more--></p>
<p>Unicast ARP is used in <a href="https://support.microsoft.com/en-us/kb/949589">Windows</a> and <a href="http://stackoverflow.com/questions/23321355/unicast-arp-requests">Linux</a> to verify remote system reachability (see also <a href="http://blog.ipspace.net/2015/05/arp-processing-in-layer-3-only-networks.html">this blog post</a>), but I never heard of Cisco IOS using it to refresh its ARP cache. Time for another test.</p>
<h4>Getting my Hands Dirty</h4><p>I used the same VIRL setup as in the <a href="http://blog.ipspace.net/2016/06/directed-arp-and-icmp-redirects.html">previous blog post</a>. After the initial communication was established, the IOS router had ARP entries for its interfaces and the two Linux servers:</p>
<pre class="code">GW#<strong>show&nbsp;arp</strong><br />Protocol&nbsp;&nbsp;Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Age&nbsp;(min)&nbsp;&nbsp;Hardware&nbsp;Addr&nbsp;&nbsp;&nbsp;Type&nbsp;&nbsp;&nbsp;Interface<br />Internet&nbsp;&nbsp;10.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;fa16.3e63.f348&nbsp;&nbsp;ARPA&nbsp;&nbsp;&nbsp;GigabitEthernet0/1<br />Internet&nbsp;&nbsp;10.0.0.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;27&nbsp;&nbsp;&nbsp;fa16.3e99.a0ac&nbsp;&nbsp;ARPA&nbsp;&nbsp;&nbsp;GigabitEthernet0/1<br />Internet&nbsp;&nbsp;10.0.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;fa16.3e63.f348&nbsp;&nbsp;ARPA&nbsp;&nbsp;&nbsp;GigabitEthernet0/1<br />Internet&nbsp;&nbsp;10.0.1.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;fa16.3e9f.d087&nbsp;&nbsp;ARPA&nbsp;&nbsp;&nbsp;GigabitEthernet0/1</pre><p>I turned on ARP debugging and cleared the ARP cache:</p>
<pre class="code">GW#<strong>debug&nbsp;arp</strong><br />ARP&nbsp;packet&nbsp;debugging&nbsp;is&nbsp;on<br />GW#<strong>clear&nbsp;arp</strong><br />GW#<br />ARP:&nbsp;flushing&nbsp;ARP&nbsp;entries&nbsp;for&nbsp;all&nbsp;interfaces<br />IP&nbsp;ARP:&nbsp;sent&nbsp;rep&nbsp;src&nbsp;10.255.0.62&nbsp;fa16.3e0d.892c,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst&nbsp;10.255.0.62&nbsp;ffff.ffff.ffff&nbsp;GigabitEthernet0/0<br />IP&nbsp;ARP:&nbsp;sent&nbsp;rep&nbsp;src&nbsp;10.0.0.1&nbsp;fa16.3e63.f348,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst&nbsp;10.0.0.1&nbsp;ffff.ffff.ffff&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;sent&nbsp;rep&nbsp;src&nbsp;10.0.1.1&nbsp;fa16.3e63.f348,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst&nbsp;10.0.1.1&nbsp;ffff.ffff.ffff&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;sent&nbsp;req&nbsp;src&nbsp;10.0.0.1&nbsp;fa16.3e63.f348,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst&nbsp;10.0.0.5&nbsp;fa16.3e99.a0ac&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;sent&nbsp;req&nbsp;src&nbsp;10.0.0.1&nbsp;fa16.3e63.f348,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst&nbsp;10.0.1.5&nbsp;fa16.3e9f.d087&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;rcvd&nbsp;rep&nbsp;src&nbsp;10.0.0.5&nbsp;fa16.3e99.a0ac,&nbsp;dst&nbsp;10.0.0.1&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;rcvd&nbsp;rep&nbsp;src&nbsp;10.0.1.5&nbsp;fa16.3e9f.d087,&nbsp;dst&nbsp;10.0.0.1&nbsp;GigabitEthernet0/1</pre><p>The first three packets were gratuitous ARPs for router&#x2019;s own IP addresses. The next two packets were ARP requests for entries already in the ARP cache (although I told the router to clear it) and they were <em>sent as unicasts to known MAC addresses</em>.</p>
<h4>Periodic ARP refreshes</h4><p>I also knew that <a href="http://blog.ipspace.net/2007/06/ar.html">Cisco IOS refreshes ARP entries</a> instead of deleting them (<a href="http://blog.ipspace.net/2007/05/what-is-cached-cef-adjacency.html">here&#x2019;s why</a>), so I modified the ARP timeout on the Ethernet interface and waited&hellip;</p>
<pre class="code">interface&nbsp;GigabitEthernet0/1<br />&nbsp;description&nbsp;to&nbsp;L2<br />&nbsp;ip&nbsp;address&nbsp;10.0.1.1&nbsp;255.255.0.0&nbsp;secondary<br />&nbsp;ip&nbsp;address&nbsp;10.0.0.1&nbsp;255.255.0.0<br />&nbsp;arp&nbsp;timeout&nbsp;20</pre><p>Not surprisingly, this is what I got:</p>
<pre class="code">IP&nbsp;ARP:&nbsp;sent&nbsp;req&nbsp;src&nbsp;10.0.0.1&nbsp;fa16.3e63.f348,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst&nbsp;10.0.1.5&nbsp;fa16.3e9f.d087&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;rcvd&nbsp;rep&nbsp;src&nbsp;10.0.1.5&nbsp;fa16.3e9f.d087,&nbsp;dst&nbsp;10.0.0.1&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;creating&nbsp;entry&nbsp;for&nbsp;IP&nbsp;address:&nbsp;10.0.1.5,&nbsp;hw:&nbsp;fa16.3e9f.d087<br />IP&nbsp;ARP:&nbsp;sent&nbsp;req&nbsp;src&nbsp;10.0.0.1&nbsp;fa16.3e63.f348,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst&nbsp;10.0.0.5&nbsp;fa16.3e99.a0ac&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;rcvd&nbsp;rep&nbsp;src&nbsp;10.0.0.5&nbsp;fa16.3e99.a0ac,&nbsp;dst&nbsp;10.0.0.1&nbsp;GigabitEthernet0/1<br />IP&nbsp;ARP:&nbsp;creating&nbsp;entry&nbsp;for&nbsp;IP&nbsp;address:&nbsp;10.0.0.5,&nbsp;hw:&nbsp;fa16.3e99.a0ac</pre><p><strong>Lesson learned:</strong> Cisco IOS uses unicast ARP to refresh expired ARP entries. </p>
<p>Interestingly, I <a href="http://blog.ipspace.net/2007/06/ar.html">got the same result in 2007</a> but never realized what&#x2019;s really going on. Sometimes it does pay to <a href="http://www.brainyquote.com/quotes/quotes/y/yogiberra125285.html">watch carefully</a> while getting your hands dirty ;)</p>

