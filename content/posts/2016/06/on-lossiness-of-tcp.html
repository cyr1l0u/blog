---
title: "On the Lossiness of TCP"
date: "2016-06-21T08:21:00.000+02:00"
tags: [ TCP,QoS ]
---

<p>When someone tells you that &ldquo;<em>TCP is a lossy protocol</em>&rdquo; during a job interview, don&#x2019;t throw him out immediately &ndash; he was just trusting the Internet a bit too much (click to enlarge).</p>
<div class='separator'><a href="https://3.bp.blogspot.com/-yxW_vHmhU8E/V2f74co_pjI/AAAAAAAAIgI/5lMT4VP7KSIl2-pDS0N93Py8dre9ZnaWgCLcB/s1600/TCP_Lossy.png" imageanchor="1" ><img border="0" src="https://3.bp.blogspot.com/-yxW_vHmhU8E/V2f74co_pjI/AAAAAAAAIgI/5lMT4VP7KSIl2-pDS0N93Py8dre9ZnaWgCLcB/s240/TCP_Lossy.png" /></a></div>
<p class="note">Everyone has a bad hair day, and it really doesn&#x2019;t matter who published that text&hellip; but if you&#x2019;re publishing technical information, at least try to <a href="http://blog.ipspace.net/2016/01/whatever-happened-to-do-no-harm.html">do no harm</a>.<!--more--></p>
<p>Let&#x2019;s do a step-by-step walk through that bit of wisdom:</p>
<blockquote class="cite">The foundation of TCP/IP design is that the network is unreliable and packets will be lost.</blockquote>
<p>True.</p>
<blockquote class="cite">In fact, the TCP protocol demands this feature to determine the maximum possible transfer rate.<span class="apple-converted-space" style="color: 222222;">&nbsp;</span></blockquote>
<p>Wrong. TCP reacts to packet drops and delays (increased round-trip-time; RTT). It turns out it&#x2019;s better to delay packets than to drop them on low-speed links with a small number of TCP sessions, and it&#x2019;s really easy to reproduce the <a href="http://packetlife.net/blog/2008/jul/30/policing-versus-shaping/">measurement Jeremy Stretch did a long time ago</a>.</p>
<p>We could go into a lengthy discussion on when it&#x2019;s time to start dropping the packets instead of buffering them (see also <a href="https://en.wikipedia.org/wiki/Bufferbloat">Bufferbloat</a>), and how TCP <a href="https://en.wikipedia.org/wiki/Explicit_Congestion_Notification">ECN</a> could be used to alleviate congestion before the dropping starts, but that&#x2019;s way beyond the point.</p>
<blockquote class="cite">So it&#x2019;s impossible to make TCP lossless, it&#x2019;s designed into its operation.</blockquote>
<p>You don&#x2019;t have to trust me or Wikipedia, but you might trust the authors of <a href="https://www.ietf.org/rfc/rfc793.txt">RFC 793</a>:</p>
<blockquote class="cite">TCP provides for reliable inter-process communication between pairs of processes in host computers attached to distinct but interconnected computer communication networks.</blockquote>
<p>I&#x2019;d guess that <em>reliable</em> and <em>lossy</em> usually aren&#x2019;t considered synonyms.</p>
<p>Back to the lossiness of TCP&hellip; seems it has some impact on QoS:</p>
<blockquote class="cite">This is why Quality of Service never works. TCP will drop packets in almost every systems because there is less bandwidth in the network than the endpoints can transmit.</blockquote>
<p>Another sound bite for a job interview, right? ;) It&#x2019;s not totally wrong:</p>
<ul class="ListParagraph"><li>Internet-wide QoS is a <a href="http://www.internetsociety.org/qos-emperors-wardrobe-geoff-huston-isp-column">pipe dream</a>. See also <a href="http://blog.ipspace.net/2015/10/douglas-comer-on-future-of-networking.html">interview with Douglas Comer</a>.</li>
<li>Consistent QoS across more than one administrative domain is usually mission impossible.</li>
<li>In many cases it&#x2019;s easier to <a href="http://blog.ipspace.net/2014/06/can-we-just-throw-more-bandwidth-at.html">throw more bandwidth at the problem</a>.</li>
</ul>
<p>However, if:</p>
<ul class="ListParagraph"><li>you can&#x2019;t throw bandwidth at the problem, </li>
<li>you can separate your traffic into few coarse classes, and </li>
<li>you realize QoS is always a zero-sum game</li>
</ul>
<p>&hellip; then you can use QoS mechanisms like policing, shaping, queuing or dropping to improve the service offered to some traffic at the <em>cost of other traffic</em><em>. </em>Just keep in mind that you&#x2019;re trading link cost for increased operational complexity (and associated costs).</p>

