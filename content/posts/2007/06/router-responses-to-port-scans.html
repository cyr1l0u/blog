---
title: "Router's responses to port scans"
date: "2007-06-12T08:03:00.000+02:00"
tags: [ security ]
---

<a href="http://insecure.org/nmap/index.html"><img alt="" border="0" id="BLOGGER_PHOTO_ID_5074762091485532018" src="http://bp0.blogger.com/_K_pkZO5-tTg/Rm0tPCadD3I/AAAAAAAAAFw/hpOh377R87U/s200/nmap_btn_euroboy.gif" style="float:right; margin:0 0 10px 10px;cursor:pointer; cursor:hand;"/></a>Recently I was trying to figure out what the various port states reported by <a href="http://insecure.org/nmap/index.html">Nmap</a> really mean. This is what's actually going on:<ul><li>If a packet is intercepted by a router's access-list, the router sends back an ICMP <em>administratively prohibited</em> packet. This is reported as <em>filtered</em> port by Nmap (and probably as <em>stealth</em> port by some other scanners).</li>
<li>If you do a TCP SYN scan of a router and the scanned port is not active, the router sends back TCP RST packet. This is reported as <em>closed</em> port.</li>
<li>If you perform a UDP scan of a router, the router sends back ICMP <em>port unreachable</em> message if the UDP application is not active. This is reported by Nmap as <em>filtered</em> port (even though in most cases it should be equivalent to <em>closed</em> TCP port).</li>
<li>In some cases, the router simply doesn't reply to UDP scans (for example, if you scan the <em>discard</em> service). This is reported as <em>OpenÂ¦Filtered</em> (as the scanner cannot reliably determine whether the probe was dropped due to a filter or simply not replied to).</li>
</ul>
<p><strong>Note:</strong> In any case, UDP scans are way more unreliable than TCP scans due to connectionless nature of UDP.</p>
&lt;!--more--&gt;Below you'll find the debugging outputs for the most common conditions:<br/><h4>Successful TCP scan</h4>Debugged with <strong>debug ip tcp packet</strong><blockquote class="code">tcp0: I LISTEN 172.16.10.34:49620 172.16.0.1:80 seq 2116160324<br/>        OPTS 4 SYN  WIN 1024<br/>tcp0: O SYNRCVD 172.16.10.34:49620 172.16.0.1:80 seq 3992162774<br/>        OPTS 4 ACK 2116160325 SYN  WIN 4128<br/>tcp0: I SYNRCVD 172.16.10.34:49620 172.16.0.1:80 seq 2116160325<br/>        RST  WIN 0</blockquote>
<h4>TCP scan of a closed port</h4>Debugged with <strong>debug ip tcp packet</strong><blockquote class="code">tcp0: I LISTEN 172.16.10.34:50434 172.16.0.1:80 seq 1431055709<br/>        OPTS 4 SYN  WIN 1024<br/>TCP: sent RST to 172.16.10.34:50434 from 172.16.0.1:80</blockquote>
<h4>TCP scan blocked by an access-list</h4>Debugged with <strong>debug ip icmp</strong><blockquote class="code">ICMP: dst (172.16.0.1) administratively prohibited unreachable sent to 172.16.10.34</blockquote>
<h4>UDP scan of an unreachable port</h4>Debugged with <strong>debug ip udp</strong> and <strong>debug ip icmp</strong><blockquote class="code">UDP: rcvd src=172.16.10.34(37312), dst=172.16.0.1(8), length=8<br/>ICMP: dst (172.16.0.1) port unreachable sent to 172.16.10.34</blockquote>

