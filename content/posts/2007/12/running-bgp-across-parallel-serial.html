---
title: "Running BGP across parallel serial links"
date: "2007-12-13T07:26:00.000+01:00"
tags: [ BGP,load balancing ]
---

<a href="http://www.nil.com/ipcorner"><img src="http://www.nil.com/C1256F0A00429755/free_tips_IP_Corner.gif" style="float: right; margin: 2px 0px 6px 3px; border-width: 0px;" /></a>Whenever I'm describing the idea of running BGP across parallel serial links with duplicate IP addresses (like I did in the November <a href="http://www.nil.com/ipcorner">IP Corner</a> article, <a href="http://www.nil.com/ipcorner/LoadBalancingBGP/"><em>Load Balancing in BGP Networks</em></a>, section <em>External BGP Load Balancing</em>), there's always someone asking &ldquo;does it really work?&rdquo; &hellip; so I'm enclosing a tested working configuration.<script>startHide()</script><table class='codeTable'><tr><th>AS 11</th><th>AS 12</th></tr><tr><td><blockquote class='code'>interface Serial1/1<br />&nbsp;ip address 10.0.1.9 255.255.255.252<br />&nbsp;encapsulation ppp<br />!<br />interface Serial1/2<br />&nbsp;ip address 10.0.1.9 255.255.255.252<br />&nbsp;encapsulation ppp<br />!<br />router bgp 11<br />&nbsp;bgp log-neighbor-changes<br />&nbsp;neighbor 10.0.1.10 remote-as 12</blockquote>
</td><td><blockquote class='code'>interface Serial1/1<br />&nbsp;ip address 10.0.1.10 255.255.255.252<br />&nbsp;encapsulation ppp<br />!<br />interface Serial1/2<br />&nbsp;ip address 10.0.1.10 255.255.255.252<br />&nbsp;encapsulation ppp<br />!<br />router bgp 12<br />&nbsp;bgp log-neighbor-changes<br />&nbsp;network 172.16.0.0<br />&nbsp;neighbor 10.0.1.9 remote-as 11<br />!<br />ip route 172.16.0.0 255.255.0.0 Null0</blockquote>
</td></tr></table>Here are a few printouts. First the BGP neighbors &hellip;<pre class='code'>AS11#<strong>show ip bgp summary &brvbar; begin Neighbor</strong><br />Neighbor   V  AS MsgRcvd MsgSent TblVer  InQ OutQ Up/Down  State/PfxRcd<br />10.0.1.10  4  12      13      12      2    0    0 00:09:02        1</pre>&hellip; then the BGP routing table &hellip;<pre class='code'>R2#<strong>show ip bgp | begin Network</strong><br />&nbsp;&nbsp;&nbsp;Network     Next Hop    Metric LocPrf Weight Path<br />*&gt; 172.16.0.0  10.0.1.10        0             0 12 i</pre>&hellip; and finally the <a href="http://ioshints.blogspot.com/2006/10/cef-load-sharing-details.html">internal details of the CEF entry</a> (that's the only way to actually verify that the load balancing is taking place):<pre class='code'>AS11#<strong>show ip cef 172.16.0.0 internal</strong><br />172.16.0.0/16, version 35, epoch 0, per-destination sharing<br />0 packets, 0 bytes<br />&nbsp;&nbsp;tag information from 10.0.1.10/32, shared<br />&nbsp;&nbsp;&nbsp;&nbsp;local tag: 17<br />&nbsp;&nbsp;via 10.0.1.10, 0 dependencies, recursive<br />&nbsp;&nbsp;&nbsp;&nbsp;next hop 10.0.1.10, Serial1/1 via 10.0.1.10/32<br />&nbsp;&nbsp;&nbsp;&nbsp;valid adjacency<br />&nbsp;&nbsp;&nbsp;&nbsp;tag rewrite with Se1/1, point2point, tags imposed: {}<br />&nbsp;<br />&nbsp;&nbsp;Recursive load sharing using 10.0.1.10/32<br />&nbsp;&nbsp;Load distribution: 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 (refcount 2)<br />&nbsp;<br />&nbsp;&nbsp;Hash  OK  Interface                 Address         Packets  Tags imposed<br />&nbsp;&nbsp;1     Y   Serial1/1                 point2point           0    none<br />&nbsp;&nbsp;2     Y   Serial1/2                 point2point           0    none<br />&nbsp;&nbsp;3     Y   Serial1/1                 point2point           0    none<br />&nbsp;&nbsp;4     Y   Serial1/2                 point2point           0    none<br />&nbsp;&nbsp;5     Y   Serial1/1                 point2point           0    none<br />&nbsp;&nbsp;6     Y   Serial1/2                 point2point           0    none<br />&nbsp;&nbsp;7     Y   Serial1/1                 point2point           0    none<br />&nbsp;&nbsp;8     Y   Serial1/2                 point2point           0    none<br />&nbsp;&nbsp;9     Y   Serial1/1                 point2point           0    none<br />&nbsp;&nbsp;10    Y   Serial1/2                 point2point           0    none<br />&nbsp;&nbsp;11    Y   Serial1/1                 point2point           0    none<br />&nbsp;&nbsp;12    Y   Serial1/2                 point2point           0    none<br />&nbsp;&nbsp;13    Y   Serial1/1                 point2point           0    none<br />&nbsp;&nbsp;14    Y   Serial1/2                 point2point           0    none<br />&nbsp;&nbsp;15    Y   Serial1/1                 point2point           0    none<br />&nbsp;&nbsp;16    Y   Serial1/2                 point2point           0    none<br /></pre><script>endHide()</script>

