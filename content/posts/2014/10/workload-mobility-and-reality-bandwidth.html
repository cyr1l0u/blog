---
title: "Workload Mobility and Reality: Bandwidth Constraints"
date: "2014-10-17T11:43:00.000+02:00"
tags: [ Design,Data Center,WAN ]
---

<p>People talking about long-distance workload mobility and cloudbursting often forget the physical reality documented in the <a href="http://en.wikipedia.org/wiki/Fallacies_of_distributed_computing">fallacies of distributed computing</a>. Today we&#x2019;ll focus on <em>bandwidth</em>, in a follow-up blog post we&#x2019;ll deal with its ugly cousin <em>latency</em>.</p>
<p><strong>TL&amp;DR summary:</strong> If you plan to spread application components across the network without understanding their network requirements, you&#x2019;ll get the results you deserve.<!--more--></p>
<p>Every client-server application has to deal with bandwidth constraints. Some of them are reasonably well understood (eventually we get most web sites to work over real-life networks), but the intricacies of connectivity within the application stack usually remain a mystery. After all, most development environments have infinite bandwidth available on the <em>loopback </em>interface.</p>
<h4>The Basics</h4><p>Almost every application stack providing interactive services to its clients uses architecture similar to this one:</p>
<div class='separator'><a href="http://1.bp.blogspot.com/-ytJMhpH5S50/VDud9U8-95I/AAAAAAAAH8o/GMhLkwdJ1UY/s1600/10%2B-%2BGeneric%2BStack.jpg" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-ytJMhpH5S50/VDud9U8-95I/AAAAAAAAH8o/GMhLkwdJ1UY/s500/10%2B-%2BGeneric%2BStack.jpg" /></a></div>
<p>Typical web applications organize the functionality of the generic architecture into the following components (one or more of the components might be missing, and there might be interactions with caching and authentication servers). Sometimes these components reside within a single server/VM/container; larger applications tend to spread them across multiple servers.</p>
<div class='separator'><a href="http://4.bp.blogspot.com/-bvwFk1WPEoA/VDud7f1g5UI/AAAAAAAAH8Y/kuwAM82Aa4g/s1600/11%2B-%2BWeb%2BApp%2BStack.jpg" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-bvwFk1WPEoA/VDud7f1g5UI/AAAAAAAAH8Y/kuwAM82Aa4g/s300/11%2B-%2BWeb%2BApp%2BStack.jpg" /></a></div>
<h4>Collecting the Requirements</h4><p>Whenever someone comes along with the wonderful idea of spreading an application stack across multiple locations, ask him to analyze the network requirements of the application. Let&#x2019;s focus on the <em>transferred data </em>first: how much data is transferred between application tiers for a typical user interaction?</p>
<p>The results will probably resemble this diagram (which is definitely not to scale): the data transfer toward the web browser is pretty optimized, and there&#x2019;s lots of data being transferred between the application tiers and between servers and storage nodes to generate the response to the user&#x2019;s request.</p>
<div class='separator'><a href="http://1.bp.blogspot.com/-gfsu_Ail8No/VDud7X8ywWI/AAAAAAAAH8U/GtYxFw8QS7Q/s1600/12%2B-%2BData%2BRequirements.jpg" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-gfsu_Ail8No/VDud7X8ywWI/AAAAAAAAH8U/GtYxFw8QS7Q/s400/12%2B-%2BData%2BRequirements.jpg" /></a></div>
<h4>Bandwidth Constraints</h4><p>Next: add the bandwidth constraints. There&#x2019;s limited bandwidth between web browser and web server, and almost unlimited bandwidth between the web server and other parts of the application stack:</p>
<div class='separator'><a href="http://1.bp.blogspot.com/-V1_gyKQahIU/VDud_wqhvOI/AAAAAAAAH9E/qLO1dcGEI4c/s1600/13%2B-%2BAvailable%2BBandwidth.jpg" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-V1_gyKQahIU/VDud_wqhvOI/AAAAAAAAH9E/qLO1dcGEI4c/s500/13%2B-%2BAvailable%2BBandwidth.jpg" /></a></div>
<p>Add the amount of data transferred to the picture and you&#x2019;ll get an idea about the <em>time it takes to transfer the interaction-related data </em>from storage (or wherever else the original data is stored) to the client (orange bars in the picture):</p>
<div class='separator'><a href="http://1.bp.blogspot.com/-rz5x1vma9Bs/VDud9Gk0t-I/AAAAAAAAH8k/dDD0ELXhRkc/s1600/14%2B-%2BTransfer%2Btime.jpg" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-rz5x1vma9Bs/VDud9Gk0t-I/AAAAAAAAH8k/dDD0ELXhRkc/s500/14%2B-%2BTransfer%2Btime.jpg" /></a></div>
<h4>Impact of Workload Migration</h4><p>Finally, change the bandwidth constraints between the components of the application stack based on where these components reside in the new geographically dispersed architecture. For example, the application developers might want to move the web- and application server into the cloud while the security team insists the database server remains in well-protected on-premises data center.</p>
<div class='separator'><a href="http://1.bp.blogspot.com/-suRFpVN5pfQ/VDud9mxwqkI/AAAAAAAAH8s/bqhqjSqGw8k/s1600/15%2B-%2BReduced%2BTier%2BBandwidth.jpg" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-suRFpVN5pfQ/VDud9mxwqkI/AAAAAAAAH8s/bqhqjSqGw8k/s400/15%2B-%2BReduced%2BTier%2BBandwidth.jpg" /></a></div>
<p>Reduced bandwidth between application- and database server results in increased response time (increased total height of all orange bars). For whatever reason, this result occasionally surprises some people.</p>
<p class='warn'>Usable bandwidth between application tiers might be lower than the maximum available bandwidth due to TCP constraints - see <a href="https://www.switch.ch/network/tools/tcp_throughput/">TCP throughput calculator</a> (based on <a href="http://www.netcraftsmen.com/tcp-performance-and-the-mathis-equation/">Mathis formula</a>) for more details (/HT to <a href="https://twitter.com/LapTop006/status/523073849915494400">Julien Goodwin</a>)</p>
<div class='separator'><a href="http://4.bp.blogspot.com/-3QxZmmtaZVs/VDud-EooP2I/AAAAAAAAH8w/osrMoTrVhXE/s1600/16%2B-%2BIncreased%2BTransfer%2BTime.jpg" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-3QxZmmtaZVs/VDud-EooP2I/AAAAAAAAH8w/osrMoTrVhXE/s400/16%2B-%2BIncreased%2BTransfer%2BTime.jpg" /></a></div>
<p class="note">Try to remain realistic when estimating the available bandwidth between application components. If you move your application server to another data center reachable through an 80% utilized 1Gbps link, you won&#x2019;t get more than 200 Mbps on that link (on a good day&hellip; and assuming nobody else gets the same ideas).</p>
<h4>Isn&#x2019;t This Obvious?</h4><p>It should be, but as one of my fellow networking gurus recently told me: &ldquo;You have no idea how many times your <a href="http://blog.ipspace.net/2011/09/long-distance-vmotion-for-disaster.html"><em>Do the math before considering long-distance vMotion</em></a><em> </em>post saved my day&rdquo;.</p>
<p>Also, keep in mind that these days bandwidth is no longer the primary constraint. Latency plays a much bigger role than it used to.</p>

