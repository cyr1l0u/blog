---
title: "Local-AS has to be matched by incoming filter-list"
date: "2008-03-20T07:32:00.002+01:00"
tags: [ BGP ]
---

<iframe src="http://rcm-na.amazon-adsystem.com/e/cm?t=cisioshinandt-20&o=1&p=6&l=st1&mode=books&search=Cisco%20BGP&fc1=000000&lt1=_blank&lc1=3366FF&bg1=FFFFFF&f=ifr" marginwidth="0" marginheight="0" width="120" height="150" border="0" frameborder="0" style="border:none; float: right;" scrolling="no"></iframe>In a previous post I've described how you can use <strong>neighbor local-as</strong> feature to <a href="http://ioshints.blogspot.com/2008/01/fix-bgp-as-number-mismatch.html">fix AS-number mismatch</a> between adjacent autonomous systems. However, without additional options, the <strong>local-as</strong> is inserted in the AS-path of incoming BGP updates <em>before any inbound filters</em>. Your inbound filters thus have to match the <strong>local-as</strong> as well.<script>startHide()</script>Consider, for example, the following configuration:<pre class='code'>router bgp 65001<br />&nbsp;neighbor 10.1.0.2 remote-as 10<br />&nbsp;neighbor 10.1.0.2 local-as 20<br />&nbsp;neighbor 10.1.0.2 filter-list 1 in<br />!<br />ip as-path access-list 1 permit ^10$</pre>Although the configuration looks correct, no routes are accepted from AS 10, as the inbound AS-path always contains locally prepended AS 20 as well as AS 10:<pre class='code'>R1#<strong>show ip bgp neighbor 10.1.0.2 received-routes | begin ^$</strong><br />&nbsp;<br />&nbsp;&nbsp;&nbsp;Network     Next Hop      Metric LocPrf Weight Path<br />*  172.16.0.0  10.1.0.2           0             0 <span class='high'>20 10</span> i</pre>To fix this problem, you either have to include local AS in the AS-path access-list or <a href="http://ioshints.blogspot.com/2008/01/fix-bgp-as-number-mismatch.html">use the <strong>no-prepend</strong> option of the <strong>neighbor local-as</strong> command</a>.<script>endHide()</script><p class="note">You can get in-depth information on AS-path access-lists in our <a href="http://www.nil.si/ls/BS_BGP32?showlp">Configuring BGP on Cisco Routers</a> <a href="http://www.nil.si/C1256F0A00429755/html/bs_portfolio">e-learning solution</a>. If you just need to practice them together with other BGP configuration tasks, the <a href="http://www.nil.si/ls/LB_RL_BGP32?showlp">BGP Remote Lab Bundle</a> is the perfect choice.</p>

