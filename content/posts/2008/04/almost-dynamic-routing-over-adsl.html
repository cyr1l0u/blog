---
title: "Almost-dynamic routing over ADSL interfaces"
date: "2008-04-23T07:29:00.002+02:00"
tags: [ IP routing,WAN,ADSL ]
---

<p>Recently I had to implement Internet access using ADSL as the primary link and ISDN as the backup link. Obviously the most versatile solution would use the techniques described in my <a href="http://www.nil.com/ipcorner">IP Corner</a> article <a href="http://www.nil.com/ipcorner/SmallSiteMultiHoming/">Small Site Multi-homing</a>, but the peculiarities of Cisco IOS implementation of the ADSL technology resulted in a much simpler solution.</p>
<!--more--><p>IOS implementation of PPPoE links uses dialer interfaces. However, the “dialing” on these interfaces is activated as soon as the underlying PPPoE session is active (before the first <em>interesting</em> packet is routed to the interface). When the simulated dial-out occurs, the router starts PPP negotiations including the IPCP handshake, which usually results in an IP address assigned to the dialer interface. Net result: if the dialer interface has an IP address, the PPPoE session is obviously active (and vice versa).</p>
<p>As my ADSL link and the ISDN backup used the same service provider (and very probably the same Radius servers), it made no sense to define additional IP SLA measurements to figure out if the service provider's network is operational; the IP route to the primary dialer interface is installed as soon as the interface is ready to route IP packets. The relevant parts of the router's configuration are included below.</p>
<pre class="code">interface FastEthernet0<br/> description outside LAN<br/> no ip address<br/> ip virtual-reassembly<br/> duplex auto<br/> speed auto<br/> pppoe enable group global<br/> pppoe-client dial-pool-number 3<br/>!<br/>interface BRI0<br/> description ISDN line<br/> encapsulation ppp<br/> dialer pool-member 1<br/> isdn switch-type basic-net3<br/>!<br/>interface <span style="color: red">Dialer0</span><br/> description ADSL primary uplink<br/> ip address negotiated<br/> ip mtu 1492<br/> ip nat outside<br/> encapsulation ppp<br/> dialer pool 3<br/>!<br/>interface <span style="color: blue">Dialer1</span><br/> description ISDN backup<br/> ip address negotiated<br/> ip nat outside<br/> dialer pool 1<br/>!<br/>track 100 interface <span style="color: red">Dialer0</span> ip routing<br/> delay down 10 up 10<br/>!<br/>ip route 0.0.0.0 0.0.0.0 <span style="color: red">Dialer0</span> 10 track 100<br/>ip route 0.0.0.0 0.0.0.0 <span style="color: blue">Dialer1</span> 250<br/></pre>

