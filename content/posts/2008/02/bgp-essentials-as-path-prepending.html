---
title: "BGP Essentials: AS-path prepending"
date: "2008-02-07T07:05:00.001+01:00"
tags: [ BGP ]
---

<p>Enterprise networks primarily use BGP with their Internet Service Providers if they want to be multi-homed (connected to more than one ISP). A very common requirement in a multi-homed design is the primary/backup setup where the lower speed (or sometimes lower quality) link should only be used when the primary link fails.</p>
&lt;!--more--&gt;<p>Competent ISPs help their customers reach this goal by using <em>BGP local preference</em> within their network and giving the customers the ability to indicate the desired value of BGP local preference through <em>BGP communities</em>: if the route received directly from the customer has low local preference, all other routes are preferred, resulting in the desired traffic flow that avoids the backup link if at all possible as shown in the next diagram:</p>
<a href="http://bp3.blogger.com/_K_pkZO5-tTg/R5odIJfbEGI/AAAAAAAABCs/YHVy4cpwfIs/s1600-h/LocPref.jpg"><img alt="" border="0" id="BLOGGER_PHOTO_ID_5159468348930199650" src="http://bp3.blogger.com/_K_pkZO5-tTg/R5odIJfbEGI/AAAAAAAABCs/YHVy4cpwfIs/s400/LocPref.jpg" style="DISPLAY: block; MARGIN: 1em auto; CURSOR: hand; TEXT-ALIGN: center"/></a> <p>Sometimes you are forced to deal with less than ideal ISPs (or the two ISPs you’re using are so far apart in the Internet topology that the BGP local preference solution doesn’t work). In these cases, the only means of influencing BGP route selection in the Internet is the extension of the AS path attribute (routes with shorter AS paths are preferred) with multiple copies of your own AS number: AS-path prepending. AS-path prepending is configured in Cisco IOS with <strong>route-map</strong> based per-neighbor outbound filter. The actual prepending is specified within the <strong>route-map</strong> with the <strong>set as-path prepend</strong> command, as illustrated in the following sample configuration:</p>
<pre class="code">router bgp 65001<br/> neighbor 10.1.0.2 remote-as 65200<br/> neighbor 10.1.0.2 description Backup ISP<br/> neighbor 10.1.0.2 route-map prepend out<br/>!<br/>route-map prepend permit 10<br/> set as-path prepend 65001 65001 65001<br/></pre><br/><p class="note">If you're looking for more in-depth BGP knowledge, try our <a href="http://www.nil.si/ls/BS_BGP32?showlp">Configuring BGP on Cisco Routers</a> <a href="http://www.nil.si/C1256F0A00429755/html/bs_portfolio">e-learning solution</a>. If you just need to enhance your hands-on skill, the <a href="http://www.nil.si/ls/LB_RL_BGP32?showlp">BGP Remote Lab Bundle</a> is the perfect choice.</p>

