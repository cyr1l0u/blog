---
url: /2008/02/use-slow-igp-startup-in-ldp-only-mpls.html
title: "Use slow IGP startup in LDP-only MPLS environments"
date: "2008-02-05T07:31:00.000+01:00"
tags: [ MPLS,OSPF,LDP ]
---

If you use LDP-based MPLS as the only means of transporting data across your network core (for example, in MPLS VPN networks or in BGP-free ISP core), a router startup might disrupt your Label Switched Paths (remember: they are always based on IGP best paths) leading to temporary disruption in service.<!--more-->For example, when the router P1 in the network shown in the following diagram is powered on and its IGP advertises its presence, the IGP-derived path from PE1 to PE2 will go over P1. If the LDP on P1 has not exchanged labels with PE1 and PE2, there will be no LSP on the shortest path between PE1 and PE2, resulting in a loss of traffic until the labels are exchanged and LSP is built.<a href="http://bp0.blogger.com/_K_pkZO5-tTg/R5nY3pfbEFI/AAAAAAAABCk/NlsRoHYVWls/s1600-h/LDP.jpg"><img alt="" border="0" id="BLOGGER_PHOTO_ID_5159393298671669330" src="http://bp0.blogger.com/_K_pkZO5-tTg/R5nY3pfbEFI/AAAAAAAABCk/NlsRoHYVWls/s400/LDP.jpg" style="DISPLAY: block; MARGIN: 1em auto; CURSOR: hand; TEXT-ALIGN: center"/></a>The proper router startup timing in this environment is thus: <ul><li>Start IGP and find neighbors.</li>
<li>Receive IGP updates and build the network topology.</li>
<li>Start LDP and exchange labels for all prefixes in the network.</li>
<li>Advertise router's presence in IGP.</li>
</ul>
You can configure slow OSPF startup with the <strong>max-metric router-lsa on-startup <em>seconds</em></strong> router configuration command. The corresponding IS-IS command is <strong>set-overload-bit on-startup <em>seconds</em></strong>.<br/><br/>The initial IGP delay has to be configured manually (you cannot use <strong>wait-for-bgp</strong> option in this scenario) and should take in account the time needed to:<br/><ul><li>Find IGP neighbors (at least the <em>hello </em>timer);</li>
<li>Receive LSA updates;</li>
<li>Run SPF (at least the <em>spf delay</em>).</li>
<li>Find LDP neighbors (at least the <em>discovery hello interval</em>).</li>
<li>Exchange labels once the SPF run has completed.</li>
</ul>
<p>Unless you're under very rigid time constraints, 30 seconds seems like a reasonable delay in most environments.</p>

